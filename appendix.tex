\chapter{Tog Generated Code}
\label{appendix:generatedTog}

\begin{togcode} 
module Monoid  where
  record Monoid (A : Set) : Set where
   constructor MonoidC
   field
     e : A
     op : A -> A -> A
     lunit_e : (x : A) -> op e x == x
     runit_e : (x : A) -> op x e == x
     associative_op : (x : A) (y : A) (z : A) -> 
                      op (op x y) z == op x (op y z)
  record Sig (AS : Set) : Set where
   constructor SigSigC
   field
     eS : AS
     opS : AS -> AS -> AS
\end{togcode} 
\begin{togcode}      
  record Product (A : Set) : Set where
   constructor ProductC
   field
     eP : Prod A A
     opP : Prod A A -> Prod A A -> Prod A A
     lunit_eP : (xP : Prod A A) -> opP eP xP == xP
     runit_eP : (xP : Prod A A) -> opP xP eP == xP
     associative_opP : (xP : Prod A A) (yP : Prod A A) (zP : Prod A A) -> 
                       opP (opP xP yP) zP == opP xP (opP yP zP)
  record Hom (A1 : Set) (A2 : Set) 
             (Mo1 : Monoid A1) (Mo2 : Monoid A2) : Set where
   constructor HomC
   field
     hom : A1 -> A2
     pres-e : hom (e Mo1) == e Mo2
     pres-op : (x1 : A1) (x2 : A1) -> 
               hom (op Mo1 x1 x2) == op Mo2 (hom x1) (hom x2)
  record RelInterp (A1 : Set) (A2 : Set) 
              (Mo1 : Monoid A1) (Mo2 : Monoid A2) : Set where
   constructor RelInterpC
   field
     interp : A1 -> A2 -> Set
     interp-e : interp (e Mo1) (e Mo2)
     interp-op : (x1 : A1) (x2 : A1) (y1 : A2) (y2 : A2) -> 
                    interp x1 y1 -> interp x2 y2 -> 
                    interp (op Mo1 x1 x2) (op Mo2 y1 y2)
\end{togcode} 
\begin{togcode}                     
  data MonoidTerm : Set where
    eL : MonoidTerm
    opL : MonoidTerm -> MonoidTerm -> MonoidTerm
  data ClMonoidTerm (A : Set) : Set where
    sing : A -> ClMonoidTerm A
    eCl : ClMonoidTerm A
    opCl : ClMonoidTerm A -> ClMonoidTerm A -> ClMonoidTerm A
  data OpMonoidTerm (n : Nat) : Set where
    v : Fin n -> OpMonoidTerm n
    eOL : OpMonoidTerm n
    opOL : OpMonoidTerm n -> OpMonoidTerm n -> OpMonoidTerm n
  data OpMonoidTerm2 (n : Nat) (A : Set) : Set where
    v2 : Fin n -> OpMonoidTerm2 n A
    sing2 : A -> OpMonoidTerm2 n A
    eOL2 : OpMonoidTerm2 n A
    opOL2 : OpMonoidTerm2 n A -> OpMonoidTerm2 n A -> OpMonoidTerm2 n A
 
  simplifyB : MonoidTerm -> MonoidTerm
  simplifyB (opL (eL ) x ) = x
  simplifyB (opL x (eL ) ) = x
  simplifyB (eL ) = eL
  simplifyB (opL x1 x2 ) = opL (simplifyB x1) (simplifyB x2)
    
  simplifyCl : (A : Set) -> ClMonoidTerm A -> ClMonoidTerm A
  simplifyCl _ (opCl (eCl ) x ) = x
  simplifyCl _ (opCl x (eCl ) ) = x
  simplifyCl _ (eCl ) = eCl
  simplifyCl _ (opCl x1 x2 ) = opCl (simplifyCl _ x1) (simplifyCl _ x2)
  simplifyCl _ (sing x1 ) = sing x1
\end{togcode} 
\begin{togcode}     
  simplifyOpB : (n : Nat) -> OpMonoidTerm n -> OpMonoidTerm n
  simplifyOpB _ (opOL (eOL ) x ) = x
  simplifyOpB _ (opOL x (eOL ) ) = x
  simplifyOpB _ (eOL ) = eOL
  simplifyOpB _ (opOL x1 x2 ) = opOL (simplifyOpB _ x1) (simplifyOpB _ x2)
  simplifyOpB _ (v x1 ) = v x1

  simplifyOp : (n : Nat) (A : Set) -> OpMonoidTerm2 n A -> OpMonoidTerm2 n A
  simplifyOp _ _ (opOL2 (eOL2 ) x ) = x
  simplifyOp _ _ (opOL2 x (eOL2 ) ) = x
  simplifyOp _ _ (eOL2 ) = eOL2
  simplifyOp _ _ (opOL2 x1 x2 ) = opOL2 (simplifyOp _ _ x1) (simplifyOp _ _ x2)
  simplifyOp _ _ (v2 x1 ) = v2 x1
  simplifyOp _ _ (sing2 x1 ) = sing2 x1
 
  evalB : (A : Set) -> Monoid A -> MonoidTerm -> A
  evalB _ Mo (eL ) = e Mo
  evalB _ Mo (opL x1 x2 ) = op Mo (evalB _ Mo x1) (evalB _ Mo x2)
  
  evalCl : (A : Set) -> Monoid A -> ClMonoidTerm A -> A
  evalCl _ Mo (sing x1 ) = x1
  evalCl _ Mo (eCl ) = e Mo
  evalCl _ Mo (opCl x1 x2 ) = op Mo (evalCl _ Mo x1) (evalCl _ Mo x2)
  
  evalOpB : (A : Set) (n : Nat) -> Monoid A -> Vec A n -> OpMonoidTerm n -> A
  evalOpB _ n Mo vars (v x1 ) = lookup _ n x1 vars
  evalOpB _ n Mo vars (eOL ) = e Mo
  evalOpB _ n Mo vars (opOL x1 x2 ) = 
        op Mo (evalOpB _ n Mo vars x1) (evalOpB _ n Mo vars x2)
\end{togcode}
\begin{togcode}    
  evalOp : (A : Set) (n : Nat) -> Monoid A -> Vec A n -> 
                              OpMonoidTerm2 n A -> A
  evalOp _ n Mo vars (v2 x1 ) = lookup _ n x1 vars
  evalOp _ n Mo vars (sing2 x1 ) = x1
  evalOp _ n Mo vars (eOL2 ) = e Mo
  evalOp _ n Mo vars (opOL2 x1 x2 ) = 
         op Mo (evalOp _ n Mo vars x1) (evalOp _ n Mo vars x2)
 
  inductionB : (P : MonoidTerm -> Set) -> P eL -> 
               ((x1 : MonoidTerm) (x2 : MonoidTerm) -> 
                P x1 -> P x2 -> P (opL x1 x2)) -> 
               (x : MonoidTerm) -> P x
  inductionB p pel popl (eL ) = pel
  inductionB p pel popl (opL x1 x2 ) = 
         popl _ _ (inductionB p pel popl x1) (inductionB p pel popl x2)
  
  inductionCl : (A : Set) (P : ClMonoidTerm A -> Set) -> 
                ((x1 : A) -> P (sing x1)) -> P eCl -> 
                ((x1 : ClMonoidTerm A) (x2 : ClMonoidTerm A) -> 
                  P x1 -> P x2 -> P (opCl x1 x2)) -> 
                (x : ClMonoidTerm A) -> P x
  inductionCl _ p psing pecl popcl (sing x1 ) = psing x1
  inductionCl _ p psing pecl popcl (eCl ) = pecl
  inductionCl _ p psing pecl popcl (opCl x1 x2 ) = 
        popcl _ _ (inductionCl _ p psing pecl popcl x1) 
                  (inductionCl _ p psing pecl popcl x2)
\end{togcode}                  
\begin{togcode} 
  inductionOpB : (n : Nat) (P : OpMonoidTerm n -> Set) -> (
                   (fin : Fin n) -> P (v fin)) -> P eOL -> 
                   ((x1 : OpMonoidTerm n) (x2 : OpMonoidTerm n) -> 
                     P x1 -> P x2 -> P (opOL x1 x2)) -> 
                   (x : OpMonoidTerm n) -> P x
  inductionOpB _ p pv peol popol (v x1 ) = pv x1
  inductionOpB _ p pv peol popol (eOL ) = peol
  inductionOpB _ p pv peol popol (opOL x1 x2 ) = 
         popol _ _ (inductionOpB _ p pv peol popol x1) 
                   (inductionOpB _ p pv peol popol x2)

  inductionOp : (n : Nat) (A : Set) (P : OpMonoidTerm2 n A -> Set) -> 
                ((fin : Fin n) -> P (v2 fin)) -> 
                ((x1 : A) -> P (sing2 x1)) -> P eOL2 -> 
                ((x1 : OpMonoidTerm2 n A) (x2 : OpMonoidTerm2 n A) -> 
                P x1 -> P x2 -> P (opOL2 x1 x2)) -> 
                (x : OpMonoidTerm2 n A) -> P x
  inductionOp _ _ p pv2 psing2 peol2 popol2 (v2 x1 ) = pv2 x1
  inductionOp _ _ p pv2 psing2 peol2 popol2 (sing2 x1 ) = psing2 x1
  inductionOp _ _ p pv2 psing2 peol2 popol2 (eOL2 ) = peol2
  inductionOp _ _ p pv2 psing2 peol2 popol2 (opOL2 x1 x2 ) = 
         popol2 _ _ (inductionOp _ _ p pv2 psing2 peol2 popol2 x1) 
                    (inductionOp _ _ p pv2 psing2 peol2 popol2 x2)
\end{togcode} 
\begin{togcode}  
  eL' : MonoidTerm
  eL' = eL
  opL' : MonoidTerm -> MonoidTerm -> MonoidTerm
  opL' x1 x2 = opL x1 x2
  
  stageB : MonoidTerm -> Staged MonoidTerm
  stageB (eL ) = Now eL
  stageB (opL x1 x2 ) = 
       stage2 _ _ _ opL' (codeLift2 _ _ _ opL') (stageB x1) (stageB x2)
    
  eCl' : (A : Set) -> ClMonoidTerm A
  eCl' _ = eCl
  opCl' : (A : Set) -> ClMonoidTerm A -> ClMonoidTerm A -> ClMonoidTerm A
  opCl' _ x1 x2 = opCl x1 x2
   
  stageCl : (A : Set) -> ClMonoidTerm A -> Staged (ClMonoidTerm A)
  stageCl _ (sing x1 ) = Now (sing x1)
  stageCl _ (eCl ) = Now eCl
  stageCl _ (opCl x1 x2 ) = 
       stage2 _ _ _ (opCl' _) 
             (codeLift2 _ _ _ (opCl' _)) 
             (stageCl _ x1) (stageCl _ x2)
\end{togcode}
\begin{togcode}  
  eOL' : (n : Nat) -> OpMonoidTerm n
  eOL' _ = eOL
  opOL' : (n : Nat) -> OpMonoidTerm n -> OpMonoidTerm n -> OpMonoidTerm n
  opOL' _ x1 x2 = opOL x1 x2

  stageOpB : (n : Nat) -> OpMonoidTerm n -> Staged (OpMonoidTerm n)
  stageOpB _ (v x1 ) = const _ (code _ (v x1))
  stageOpB _ (eOL ) = Now eOL
  stageOpB _ (opOL x1 x2 ) = 
       stage2 _ _ _ (opOL' _) 
             (codeLift2 _ _ _ (opOL' _)) 
             (stageOpB _ x1) (stageOpB _ x2)

  eOL2' : (n : Nat) (A : Set) -> OpMonoidTerm2 n A
  eOL2' _ _ = eOL2
  opOL2' : (n : Nat) (A : Set) -> OpMonoidTerm2 n A -> 
                     OpMonoidTerm2 n A -> OpMonoidTerm2 n A
  opOL2' _ _ x1 x2 = opOL2 x1 x2
   
  stageOp : (n : Nat) (A : Set) -> OpMonoidTerm2 n A -> 
                     Staged (OpMonoidTerm2 n A)
  stageOp _ _ (sing2 x1 ) = Now (sing2 x1)
  stageOp _ _ (v2 x1 ) = const _ (code _ (v2 x1))
  stageOp _ _ (eOL2 ) = Now eOL2
  stageOp _ _ (opOL2 x1 x2 ) = 
       stage2 _ _ _ (opOL2' _ _) 
             (codeLift2 _ _ _ (opOL2' _ _)) 
             (stageOp _ _ x1) (stageOp _ _ x2)
\end{togcode}
\begin{togcode} 
  record StagedRepr (A : Set) (Repr : Set ~$\to$~ Set) : Set where
   constructor repr
   field
    opT : Repr A -> Repr A -> Repr A
    eT  : Repr A

\end{togcode} 